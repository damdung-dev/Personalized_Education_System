{% extends "base.html" %}
{% load static %}
{% block title %}Th∆∞ vi·ªán s√°ch{% endblock %}

{% block style %}
<style>
:root {
  --primary: #007aff;
  --secondary: #00cfff;
  --danger: #ff3b30;
  --bg-card: #fff;
  --shadow: rgba(0,0,0,0.12);
  --radius: 14px;
  --speed: 0.25s ease;
  --divider: #ddd;
}

body { 
  background: linear-gradient(135deg, #f0f4f9, #e6edf5);
  margin: 0; 
  font-family: "Segoe UI", Roboto, sans-serif;
}
.container {
  max-width: 1100px;
  margin: 40px auto;
  padding: 0 20px;
  display: flex;
  flex-direction: column;
  gap: 36px;
}

/* Card */
.card {
  background: var(--bg-card);
  border-radius: var(--radius);
  box-shadow: 0 6px 20px var(--shadow);
  padding: 22px;
  transition: transform var(--speed), box-shadow var(--speed);
}
.card:hover { transform: translateY(-4px); box-shadow: 0 10px 28px rgba(0,0,0,0.15); }

.header-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 14px;
}
.header-row h2 { margin: 0; font-size: 22px; color: var(--primary); }

/* Buttons */
.btn-group { display: flex; align-items: center; gap: 10px; }
.btn-group .divider { width: 1px; background: var(--divider); height: 24px; margin: 0 6px; }

.btn, .btn-read {
  padding: 7px 16px;
  border: none;
  border-radius: 22px;
  font-size: 14px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 10px;
  background: var(--primary);
  color: #fff;
  transition: all var(--speed);
  text-decoration: none; 
}
.btn svg, .btn-read svg { width: 16px; height: 16px; }
.btn:hover, .btn-read:hover { opacity: 0.9; transform: scale(1.05); }
.btn-danger { background: var(--danger); }
.btn-alt { background: var(--secondary); }

/* List view */
.book-list { list-style: none; margin: 0; padding: 0; }
.book-list li {
  padding: 10px 0;
  border-bottom: 1px solid #eee;
  display: flex; justify-content: space-between; align-items: center;
  gap: 10px;
}
.book-list li:last-child { border-bottom: none; }

/* Count */
.count-label {
  font-size: 13px;
  color: gray;
  display: block;
  margin-bottom: 10px;
}

/* Modal PDF */
.modal {
  display: none;
  position: fixed;
  z-index: 999;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.75);
  justify-content: center;
  align-items: center;
}
.modal-content {
  background: #fff;
  border-radius: var(--radius);
  padding: 10px;
  width: 92%; height: 92%;
  display: flex; flex-direction: column;
}
.modal-content iframe {
  flex: 1;
  border: none;
  border-radius: var(--radius);
}
.close {
  align-self: flex-end;
  font-size: 24px;
  cursor: pointer;
  color: var(--danger);
  font-weight: bold;
}
.close:hover { opacity: 0.7; }

/* Pagination */
.pagination {
  margin-top: 16px;
  display:flex; gap:10px; align-items:center; justify-content:center;
}
.pagination a { text-decoration:none; }
</style>
{% endblock %}

{% block content %}
<div class="container">

  <!-- Th∆∞ vi·ªán c·ªßa t√¥i -->
  <div class="card">
    <div class="header-row">
      <h2>üìò Th∆∞ vi·ªán c·ªßa t√¥i</h2>
      <div class="btn-group">
        <button class="btn"><svg fill="currentColor"><use href="#icon-plus"/></svg> Th√™m</button>
        <button class="btn btn-danger"><svg fill="currentColor"><use href="#icon-trash"/></svg> X√≥a</button>
        <div class="divider"></div>
        <button class="btn btn-alt"><svg fill="currentColor"><use href="#icon-list"/></svg> List</button>
        <button class="btn btn-alt"><svg fill="currentColor"><use href="#icon-grid"/></svg> C·ªôt</button>
      </div>
    </div>
    <label class="count-label">S·ªë l∆∞·ª£ng s√°ch: {{ my_documents_count }}</label>
    <ul id="myDocs" class="book-list">
      {% if documents %}
        {% for doc in documents %}
        <li>
          <div>
            üìò <a href="{{ doc.file.url }}" target="_blank">{{ doc.title }}</a>
            <span style="font-size:12px;color:gray;">({{ doc.uploaded_at|date:"d/m/Y" }})</span>
          </div>
          <button class="btn-read" onclick="openPDF('{{ doc.file.url }}')"><svg fill="currentColor"><use href="#icon-eye"/></svg> ƒê·ªçc ngay</button>
        </li>
        {% endfor %}
      {% else %}
        <li>üìò Danh s√°ch tr·ªëng</li>
      {% endif %}
    </ul>
  </div>

  <!-- S√°ch chia s·∫ª -->
  <div class="card">
    <div class="header-row">
      <h2>üìô S√°ch chia s·∫ª</h2>
      <div class="btn-group">
        <button class="btn"><svg fill="currentColor"><use href="#icon-plus"/></svg> Th√™m</button>
        <button class="btn btn-danger"><svg fill="currentColor"><use href="#icon-trash"/></svg> X√≥a</button>
        <div class="divider"></div>
        <button class="btn btn-alt"><svg fill="currentColor"><use href="#icon-list"/></svg> List</button>
        <button class="btn btn-alt"><svg fill="currentColor"><use href="#icon-grid"/></svg> C·ªôt</button>
      </div>
    </div>
    <label class="count-label">S·ªë l∆∞·ª£ng s√°ch: {{ shared_count|default:"0" }}</label>
    <ul id="sharedDocs" class="book-list">
      {% if shared_books %}
        {% for book in shared_books %}
        <li>
          <div>
            üìô <a href="{{ book.file.url }}" target="_blank">{{ book.title }}</a>
          </div>
          <button class="btn-read" onclick="openPDF('{{ book.file.url }}')"><svg fill="currentColor"><use href="#icon-eye"/></svg> ƒê·ªçc ngay</button>
        </li>
        {% endfor %}
      {% else %}
        <li>üìô Danh s√°ch tr·ªëng</li>
      {% endif %}
    </ul>
  </div>

  <!-- S√°ch tuy·ªÉn ch·ªçn -->
  <div class="card">
    <div class="header-row">
        <h2>üìñ ƒê·∫ßu s√°ch tuy·ªÉn ch·ªçn</h2>
    </div>

    <label class="count-label">S·ªë l∆∞·ª£ng s√°ch: {{ recommend_count }}</label>

    <ul class="book-list list-view">
        {% for recommend in page_obj %}
          <li>
            üìñ {{ recommend.title }}

            {% if recommend.get_link %}
                {% if recommend.is_pdf %}
                    <button class="btn-read" onclick="openPDF('{{ recommend.get_link }}', '{{ recommend.title }}')">ƒê·ªçc ngay</button>
                {% else %}
                    <a class="btn-read" href="{{ recommend.get_link }}" target="_blank">ƒê·ªçc ngay</a>
                {% endif %}
            {% else %}
                <button class="btn-read" onclick="alert('‚ùå Ch∆∞a c√≥ file ho·∫∑c URL ƒë·ªÉ ƒë·ªçc!')">ƒê·ªçc ngay</button>
            {% endif %}
          </li>
        {% empty %}
            <li>üìñ Danh s√°ch tr·ªëng</li>
        {% endfor %}
    </ul>

    <!-- Ph√¢n trang -->
    <div class="pagination">
        {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}" class="btn">‚¨Ö Trang tr∆∞·ªõc</a>
        {% endif %}
        <span>Trang {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}" class="btn">Trang sau ‚û°</a>
        {% endif %}
    </div>
  </div>
</div>

<!-- Modal PDF -->
<div id="pdfModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closePDF()">&times;</span>
    <iframe id="pdfViewer"></iframe>
  </div>
</div>

<!-- Icons -->
<svg style="display:none;">
  <symbol id="icon-plus" viewBox="0 0 24 24"><path d="M12 5v14m-7-7h14" stroke="white" stroke-width="2" fill="none" stroke-linecap="round"/></symbol>
  <symbol id="icon-trash" viewBox="0 0 24 24"><path d="M3 6h18M9 6v12m6-12v12M5 6l1 14h12l1-14" stroke="white" stroke-width="2" fill="none" stroke-linecap="round"/></symbol>
  <symbol id="icon-list" viewBox="0 0 24 24"><path d="M4 6h16M4 12h16M4 18h16" stroke="white" stroke-width="2" fill="none" stroke-linecap="round"/></symbol>
  <symbol id="icon-grid" viewBox="0 0 24 24"><path d="M4 4h7v7H4V4zm9 0h7v7h-7V4zM4 13h7v7H4v-7zm9 0h7v7h-7v-7z" fill="white"/></symbol>
  <symbol id="icon-eye" viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8S1 12 1 12zm11 3a3 3 0 100-6 3 3 0 000 6z" fill="white"/></symbol>
</svg>

{% block script %}
<script>
function openPDF(url){
  document.getElementById("pdfViewer").src = url;
  document.getElementById("pdfModal").style.display = "flex";
}
function closePDF(){
  document.getElementById("pdfViewer").src = "";
  document.getElementById("pdfModal").style.display = "none";
}
</script>
{% endblock %}
{% endblock %}
