{% extends "base.html" %}
{% load static %}
{% block title %}Th∆∞ vi·ªán s√°ch{% endblock %}

{% block style %}
<style>
:root {
  --primary: #007aff;
  --secondary: #00cfff;
  --danger: #ff3b30;
  --bg-card: #fff;
  --shadow: rgba(0,0,0,0.12);
  --radius: 14px;
  --speed: 0.3s ease;
}

body { background: #f7f9fb; margin: 0; }

.container {
  max-width: 1100px;
  margin: 30px auto;
  padding: 0 16px;
  display: flex;
  flex-direction: column;
  gap: 32px;
}

/* Card */
.card {
  background: var(--bg-card);
  border-radius: var(--radius);
  box-shadow: 0 6px 16px var(--shadow);
  padding: 20px;
  transition: transform var(--speed);
}
.card:hover { transform: translateY(-3px); }

.header-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}
.header-row h2 { margin: 0; font-size: 20px; color: var(--primary); }

/* Buttons */
.btn-group { display: flex; gap: 8px; }
.btn, .btn-read {
  padding: 6px 14px;
  border: none;
  border-radius: 18px;
  font-size: 14px;
  cursor: pointer;
  background: var(--primary);
  color: #fff;
  transition: all var(--speed);
}
.btn:hover, .btn-read:hover { opacity: 0.85; transform: scale(1.05); }
.btn-danger { background: var(--danger); }

/* List & Column view */
.book-list { list-style: none; margin: 0; padding: 0; }
.book-list li {
  padding: 8px 0;
  border-bottom: 1px solid #eee;
}
.book-list li:last-child { border-bottom: none; }
.list-view li { display: block; }
.column-view {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 12px;
}
.column-view li { border: 1px solid #eee; padding: 10px; border-radius: var(--radius); }

/* Book grid */
.book-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 16px;
}
.book-item {
  background: #fafafa;
  border-radius: var(--radius);
  padding: 14px;
  text-align: center;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  height: 100%;
}
.book-image img {
  max-width: 100%;
  height: 160px;
  object-fit: cover;
  border-radius: var(--radius);
}
.book-info {
  margin: 12px 0 8px;
}
.book-info h3 {
  font-size: 16px;
  margin: 0 0 4px;
}
.price { color: var(--danger); font-weight: 600; }
.btn-read {
  margin-top: auto;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  width: 100%;
}

/* Count */
.count-label {
  font-size: 13px;
  color: gray;
  display: block;
  margin-bottom: 8px;
}

/* Modal PDF */
.modal {
  display: none;
  position: fixed;
  z-index: 999;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.7);
  justify-content: center;
  align-items: center;
}
.modal-content {
  background: #fff;
  border-radius: var(--radius);
  padding: 10px;
  width: 90%; height: 90%;
  display: flex; flex-direction: column;
}
.modal-content iframe {
  flex: 1;
  border: none;
  border-radius: var(--radius);
}
.close {
  align-self: flex-end;
  font-size: 22px;
  cursor: pointer;
  color: var(--danger);
}
.close:hover { opacity: 0.7; }

/* Responsive */
@media(max-width:768px){
  .header-row { flex-direction: column; gap: 8px; align-items: flex-start; }
  .book-image img { height: 140px; }
}
</style>
{% endblock %}

{% block content %}
<div class="container">

  <!-- Th∆∞ vi·ªán c·ªßa t√¥i -->
  <div class="card">
    <div class="header-row">
      <h2>üìò Th∆∞ vi·ªán c·ªßa t√¥i</h2>
      <div class="btn-group">
        <button class="btn">Th√™m</button>
        <button class="btn btn-danger">X√≥a</button>
        <button class="btn" onclick="toggleView('myDocs')">Xem: C·ªôt</button>
      </div>
    </div>
    <label class="count-label">S·ªë l∆∞·ª£ng s√°ch: {{ my_documents_count }}</label>
    <ul id="myDocs" class="book-list list-view">
      {% if documents %}
        {% for doc in documents %}
        <li>
          <div style="display:flex; justify-content: space-between; align-items:center;">
            <div>
              üìò <a href="{{ doc.file.url }}" target="_blank">{{ doc.title }}</a>
              <span style="font-size:12px;color:gray;">({{ doc.uploaded_at|date:"d/m/Y" }})</span>
            </div>
            <button class="btn-read" onclick="openPDF('{{ doc.file.url }}')">ƒê·ªçc ngay</button>
          </div>
        </li>
        {% endfor %}
      {% else %}
        <li>üìò Danh s√°ch tr·ªëng</li>
      {% endif %}
    </ul>
  </div>

  <!-- S√°ch chia s·∫ª -->
  <div class="card">
    <div class="header-row">
      <h2>üìô S√°ch chia s·∫ª</h2>
      <div class="btn-group">
        <button class="btn">Th√™m</button>
        <button class="btn btn-danger">X√≥a</button>
        <button class="btn" onclick="toggleView('sharedDocs')">Xem: C·ªôt</button>
      </div>
    </div>
    <label class="count-label">S·ªë l∆∞·ª£ng s√°ch: {{ shared_count|default:"0" }}</label>
    <ul id="sharedDocs" class="book-list list-view">
      {% if shared_books %}
        {% for book in shared_books %}
        <li>
          <div style="display:flex; justify-content: space-between; align-items:center;">
            <div>
              üìô <a href="{{ book.file.url }}" target="_blank">{{ book.title }}</a>
            </div>
            <button class="btn-read" onclick="openPDF('{{ book.file.url }}')">ƒê·ªçc ngay</button>
          </div>
        </li>
        {% endfor %}
      {% else %}
        <li>üìô Danh s√°ch tr·ªëng</li>
      {% endif %}
    </ul>
  </div>

  <!-- S√°ch tuy·ªÉn ch·ªçn -->
  <div class="card">
    <h2>üìñ ƒê·∫ßu s√°ch tuy·ªÉn ch·ªçn</h2>
    <label class="count-label">S·ªë l∆∞·ª£ng s√°ch: {{ recommend_count }}</label>
    {% static 'images/default_cover.jpg' as default_cover %}
    <div class="book-grid">
      {% for recommend in recommend_books %}
      <div class="book-item">
        <div class="book-image">
          {% if recommend.cover %}
            <img src="{{ recommend.cover.url }}" alt="{{ recommend.title }}">
          {% else %}
            <img src="{% static 'images/default_cover.jpg' %}" alt="{{ recommend.title }}">
          {% endif %}
        </div>
        
        <div class="book-info">
          <h3>{{ recommend.title }}</h3>
          {% if recommend.price %}
          <p class="price">{{ recommend.price|floatformat:0 }}‚Ç´</p>
          {% endif %}
        </div>
        <button class="btn-read" onclick="openPDF('{{ recommend.file.url }}')">ƒê·ªçc ngay</button>
      </div>
      {% empty %}
        <p>Ch∆∞a c√≥ s√°ch tuy·ªÉn ch·ªçn</p>
      {% endfor %}
    </div>
  </div>

</div>

<!-- Modal PDF -->
<div id="pdfModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closePDF()">&times;</span>
    <iframe id="pdfViewer"></iframe>
  </div>
</div>

{% block script %}
<script>
function toggleView(listId){
  const list = document.getElementById(listId);
  list.classList.toggle("list-view");
  list.classList.toggle("column-view");
}
function openPDF(url){
  document.getElementById("pdfViewer").src = url;
  document.getElementById("pdfModal").style.display = "flex";
}
function closePDF(){
  document.getElementById("pdfViewer").src = "";
  document.getElementById("pdfModal").style.display = "none";
}
</script>
{% endblock %}
{% endblock %}
