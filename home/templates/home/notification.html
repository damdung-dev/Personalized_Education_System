{% extends "base.html" %}
{% block title %}Notifications{% endblock %}

{% block style %}
<style>
:root {
  --primary: #007aff;
  --bg-light: rgba(255,255,255,0.9);
  --bg-dark: rgba(30,30,30,0.9);
  --shadow: 0 8px 24px rgba(0,0,0,0.12);
  --radius: 18px;
}

/* Container */
.notifications-container {
  max-width: 760px;
  margin: 40px auto;
  background: var(--bg-light);
  backdrop-filter: blur(12px);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

/* Header */
.notifications-header {
  padding: 20px 24px;
  border-bottom: 1px solid rgba(0,0,0,0.08);
}
.notifications-header h2 {
  font-size: 24px;
  margin: 0;
  font-weight: 700;
}
.filter-btns {
  margin-top: 12px;
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}
.filter-btn {
  padding: 7px 16px;
  border-radius: 20px;
  border: none;
  cursor: pointer;
  background: rgba(0,122,255,0.1);
  color: var(--primary);
  font-size: 14px;
  transition: all 0.25s;
}
.filter-btn.active {
  background: var(--primary);
  color: #fff;
  box-shadow: 0 4px 10px rgba(0,122,255,0.25);
}
.filter-btn:hover { transform: scale(1.05); }

/* List + item */
.notifications-list { display: flex; flex-direction: column; }
.notification-item {
  display: flex;
  align-items: flex-start;
  gap: 14px;
  background: #fff;
  border-radius: var(--radius);
  padding: 16px;
  margin: 10px 16px;
  transition: all 0.3s ease;
  cursor: pointer;
  opacity: 0;
  transform: translateY(16px);
}
.notification-item.show {
  opacity: 1;
  transform: translateY(0);
}
.notification-item:hover {
  background: rgba(240,248,255,0.6);
  transform: translateY(-2px);
}
.notification-item img {
  width: 48px; height: 48px;
  border-radius: 50%;
  object-fit: cover;
  flex-shrink: 0;
}
.notification-content { flex: 1; }
.notification-title { font-weight: 600; font-size: 15px; margin:0; }
.notification-text { font-size: 14px; color: #555; margin: 4px 0; }
.notification-time { font-size: 12px; color: #999; }
.unread-dot {
  width: 10px; height: 10px;
  background: #ff3b30;
  border-radius: 50%;
  margin-top: 6px;
  animation: pulse 1.3s infinite;
}

/* Footer */
.notifications-footer {
  text-align: center;
  padding: 14px;
  border-top: 1px solid rgba(0,0,0,0.08);
}
.notifications-footer button {
  background: none;
  border: none;
  color: var(--primary);
  font-weight: 500;
  cursor: pointer;
  transition: 0.25s;
}
.notifications-footer button:hover { text-decoration: underline; }

/* Anim */
@keyframes pulse {
  0% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.3); opacity: 0.7; }
  100% { transform: scale(1); opacity: 1; }
}

/* Dark mode */
@media (prefers-color-scheme: dark) {
  .notifications-container { background: var(--bg-dark); }
  .notification-item { background: rgba(50,50,50,0.9); }
  .notification-title { color:#fff; }
  .notification-text { color:#ccc; }
  .notification-time { color:#aaa; }
}

/* Responsive */
@media (max-width:768px) {
  .notifications-container { margin:20px; }
  .notification-item { margin:6px 10px; padding:12px; }
}
</style>
{% endblock %}

{% block content %}
<div class="notifications-container">
  <!-- Header -->
  <div class="notifications-header">
    <h2>Notifications</h2>
    <div class="filter-btns">
      <button class="filter-btn active" data-filter="all">All</button>
      <button class="filter-btn" data-filter="unread">Unread</button>
      <button class="filter-btn" data-filter="today">Today</button>
      <button class="filter-btn" data-filter="week">This Week</button>
    </div>
  </div>

  <!-- List -->
  <div class="notifications-list" id="notifications-list">
    {% for n in notifications %}
    <div class="notification-item" 
         data-unread="{{ n.unread|yesno:'true,false' }}" 
         data-time="{{ n.time_tag }}">
      <img src="{{ n.icon_url }}" alt="icon">
      <div class="notification-content">
        <p class="notification-title">{{ n.title }}</p>
        <p class="notification-text">{{ n.content }}</p>
        <span class="notification-time">{{ n.time_ago }}</span>
      </div>
      {% if n.unread %}<div class="unread-dot"></div>{% endif %}
    </div>
    {% endfor %}
  </div>

  <!-- Footer -->
  <div class="notifications-footer">
    <button id="load-more-btn">See previous notifications</button>
  </div>
</div>
{% endblock %}

{% block script %}
<script>
// Fade-in
document.querySelectorAll('.notification-item')
  .forEach((item,i)=>setTimeout(()=>item.classList.add('show'), i*80));

// Filter
const filterBtns=document.querySelectorAll('.filter-btn');
filterBtns.forEach(btn=>{
  btn.addEventListener('click',()=>{
    filterBtns.forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const filter=btn.dataset.filter;
    document.querySelectorAll('.notification-item').forEach(n=>{
      let show=true;
      if(filter==='unread' && n.dataset.unread!=='true') show=false;
      if(filter==='today' && n.dataset.time!=='today') show=false;
      if(filter==='week' && n.dataset.time!=='week') show=false;
      n.style.display=show?'flex':'none';
    });
  });
});

// Swipe gesture (mobile)
function addSwipe(item){
  let startX=0,currentX=0,moving=false;
  item.addEventListener('touchstart',e=>{
    startX=e.touches[0].clientX; moving=true;
  });
  item.addEventListener('touchmove',e=>{
    if(!moving) return;
    currentX=e.touches[0].clientX;
    item.style.transform=`translateX(${currentX-startX}px)`;
  });
  item.addEventListener('touchend',()=>{
    moving=false;
    let dx=currentX-startX;
    if(dx<-100){ // delete
      item.style.opacity=0; item.style.transition='0.3s';
      setTimeout(()=>item.remove(),300);
    } else if(dx>100){ // mark read
      item.querySelector('.unread-dot')?.remove();
      item.dataset.unread='false';
      item.style.transform='translateX(0)';
    } else { item.style.transform='translateX(0)'; }
  });
}
document.querySelectorAll('.notification-item').forEach(addSwipe);

// Load more simulation
document.getElementById('load-more-btn').addEventListener('click',()=>{
  for(let i=0;i<3;i++){
    const div=document.createElement('div');
    div.className='notification-item show';
    div.dataset.unread=Math.random()>0.5?'true':'false';
    div.dataset.time='week';
    div.innerHTML=`
      <img src="https://via.placeholder.com/48" alt="icon">
      <div class="notification-content">
        <p class="notification-title">Older Notification</p>
        <p class="notification-text">This is an older one</p>
        <span class="notification-time">5d ago</span>
      </div>
      ${div.dataset.unread==='true'?'<div class="unread-dot"></div>':""}
    `;
    addSwipe(div);
    document.getElementById('notifications-list').append(div);
  }
});
</script>
{% endblock %}
